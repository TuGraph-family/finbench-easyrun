FROM arm64v8/centos:8.4.2105

RUN sed -e "s|^mirrorlist=|#mirrorlist=|g" \
         -e "s|^#baseurl=http://mirror.centos.org/\$contentdir/\$releasever|baseurl=https://mirrors.aliyun.com/centos-vault/8.4.2105|g" \
         -i.bak /etc/yum.repos.d/CentOS-*.repo

RUN yum makecache & yum install -y java-1.8.0-openjdk*

RUN cd opt \
    && wget --no-check-certificate https://tugraph-web.oss-cn-beijing.aliyuncs.com/tugraph/deps/apache-maven-3.8.7-bin.tar.gz \
    && tar xf apache-maven-3.8.7-bin.tar.gz \
    && rm apache-maven-*.tar.gz

RUN mkdir -p /data \
     && mkdir -p /root/ldbc/ldbc_finbench_driver \
     && mkdir -p /root/ldbc/ldbc_finbench_transaction_impls

COPY maven-settings.xml /root/.m2/settings.xml
COPY deps/ldbc_finbench_driver /root/ldbc/ldbc_finbench_driver
COPY deps/ldbc_finbench_transaction_impls /root/ldbc/ldbc_finbench_transaction_impls

# compile benchmark suite and modify configs
RUN cd /root/ldbc/ldbc_finbench_driver && mvn clean install \
     && cd /root/ldbc/ldbc_finbench_transaction_impls/tugraph \
     && mvn clean package